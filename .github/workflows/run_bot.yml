name: ğŸ• 2:45 AM Market Analysis

on:
  schedule:
    # 2:45 AM IST = 9:15 PM UTC
    - cron: '15 21 * * *'
  
  # Manual trigger
  workflow_dispatch:

jobs:
  analysis:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ” Check Current Time
        run: |
          echo "=========================================="
          echo "ğŸ•’ CURRENT UTC: $(date -u '+%H:%M:%S %Z')"
          echo "ğŸ‡®ğŸ‡³ CURRENT IST: $(TZ='Asia/Kolkata' date '+%H:%M:%S %Z')"
          echo "ğŸ¯ SCHEDULED FOR: 2:45 AM IST"
          echo "â° NEXT RUN: Tomorrow 2:45 AM IST"
          echo "=========================================="
      
      - name: ğŸ“¥ Download Code
        uses: actions/checkout@v3
      
      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: ğŸ“¦ Install Requirements
        run: |
          pip install --upgrade pip
          pip install yfinance pandas requests pytz numpy
      
      - name: ğŸš€ Run Analysis Script
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          echo "ğŸš€ Starting Institutional Analysis..."
          python ultimate_algo.py
      
      - name: âœ… Verify Completion
        run: |
          echo "=========================================="
          echo "âœ… ANALYSIS COMPLETED SUCCESSFULLY!"
          echo "ğŸ•’ COMPLETED AT IST: $(TZ='Asia/Kolkata' date '+%H:%M:%S')"
          echo "ğŸ“… DATE: $(TZ='Asia/Kolkata' date '+%d %b %Y')"
          echo "=========================================="
